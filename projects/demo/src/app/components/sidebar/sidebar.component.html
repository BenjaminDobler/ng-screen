<div class="properties-panel">
  <div class="properties-panel_header">
    <h2>Canvas</h2>
  </div>
  <div class="properties-panel_row">
    <label>Size</label>
    <input-component prefix="W" [(ngModel)]="settings.recordingWidth"></input-component>
    <input-component prefix="H" [(ngModel)]="settings.recordingHeight"></input-component>
  </div>
  <div class="properties-panel_row">
    <label>BG Color</label>
    <color [(ngModel)]="settings.backgroundColor"></color>
  </div>

  @let selectedVideo = settings.selectedVideo();

  @if (selectedVideo) {
    <div class="properties-panel_header">
      <h2>Clipping</h2>
    </div>
    <div class="properties-panel_row">
      <label>Type</label>
      <ed-select [(ngModel)]="selectedVideo.clipType">
        <ed-select-option value="none">None</ed-select-option>
        <ed-select-option value="circle">Circle</ed-select-option>
        <ed-select-option value="rectangle">Rectangle</ed-select-option>
      </ed-select>
    </div>

    @if (selectedVideo.clipType() !== 'none') {
      <div class="properties-panel_row">
        <label>Border</label>
        <color [(ngModel)]="selectedVideo.borderColor" />
        <input-component type="number" [(ngModel)]="selectedVideo.borderWidth"></input-component>
      </div>
    }

    <div class="properties-panel_header">
      <h2>Background</h2>
    </div>
    <div class="properties-panel_row">
      <label>Type</label>

      <ed-select [(ngModel)]="selectedVideo.videoDO().backgroundType">
        <ed-select-option value="none">None</ed-select-option>
        <ed-select-option value="blur">Blur</ed-select-option>
        <ed-select-option value="image">Image</ed-select-option>
      </ed-select>
    </div>

    @if (selectedVideo.videoDO().backgroundType() === 'blur') {
      <div class="properties-panel_row">
        <label>Blur</label>
        <input type="range" [min]="0" max="50" [(ngModel)]="selectedVideo.videoDO().blurAmount" />
      </div>
      <div class="properties-panel_row">
        <label>Edge Blur</label>
        <input
          type="range"
          [min]="0"
          max="50"
          [(ngModel)]="selectedVideo.videoDO().edgeBlurAmount"
        />
      </div>
      <div class="properties-panel_row">
        <label>FG. Thr.</label>
        <input
          type="range"
          [min]="0"
          max="1"
          step="0.01"
          [(ngModel)]="selectedVideo.videoDO().foregroundThreshold"
        />
      </div>
    }
    <div class="properties-panel_row">
      <button (click)="recordingService.bringToFront(selectedVideo.videoDO())">
        Bring to Front
      </button>
    </div>
    <input type="checkbox" [(ngModel)]="selectedVideo.showClippedHint" />
  }
</div>

<!-- <a download="recording.webm" [href]="downloadData">Download recording</a> -->

@for (recording of recordingService.recordings(); track $index) {
  <div>
    {{ recording.name }}

    <button (click)="recording.convertRecording()">Convert</button>

    <button (click)="recording.download()">Download</button>
    <button (click)="editorService.open(recording)">Edit</button>

    <!-- <button (click)="playRecording(recording)">Play</button>
    <button (click)="convertRecording(recording)">Convert</button>
    @if (recording.convertedData) {
      <button (click)="playConvertedRecording(recording)">Play Converted</button>
      <a download="{{ recording.name }}.mp4" [href]="getConvertedUrl(recording)"
        >Download Converted</a
      >
    } -->
  </div>
}

<div style="padding: 20px">
  @for (video of recordingService.videos(); track $index) {
    <div class="audio-item" [class.selected]="selectedVideo?.videoDO() === video">
      @if (video.type === 'webcam') {
        <svg
          width="16px"
          height="16px"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <circle cx="12" cy="13" r="3" stroke="#fff" stroke-width="1.5" />
          <path
            d="M2 13.3636C2 10.2994 2 8.76721 2.74902 7.6666C3.07328 7.19014 3.48995 6.78104 3.97524 6.46268C4.69555 5.99013 5.59733 5.82123 6.978 5.76086C7.63685 5.76086 8.20412 5.27068 8.33333 4.63636C8.52715 3.68489 9.37805 3 10.3663 3H13.6337C14.6219 3 15.4728 3.68489 15.6667 4.63636C15.7959 5.27068 16.3631 5.76086 17.022 5.76086C18.4027 5.82123 19.3044 5.99013 20.0248 6.46268C20.51 6.78104 20.9267 7.19014 21.251 7.6666C22 8.76721 22 10.2994 22 13.3636C22 16.4279 22 17.9601 21.251 19.0607C20.9267 19.5371 20.51 19.9462 20.0248 20.2646C18.9038 21 17.3433 21 14.2222 21H9.77778C6.65675 21 5.09624 21 3.97524 20.2646C3.48995 19.9462 3.07328 19.5371 2.74902 19.0607C2.53746 18.7498 2.38566 18.4045 2.27673 18"
            stroke="#fff"
            stroke-width="1"
            stroke-linecap="round"
          />
          <path d="M19 10H18" stroke="#fff" stroke-width="1.5" stroke-linecap="round" />
        </svg>
      } @else {
        <svg
          width="16px"
          height="16px"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M12 20.5H16M12 20.5H8M12 20.5V16.5M12 16.5C16 16.5 19.5 16.1667 20 15.8333C20.5 15.5 21 12.6667 21 10C21 7.33333 20.5 4.5 20 4.16667C19.5 3.83333 16 3.5 12 3.5C8 3.5 4.5 3.83333 4 4.16667C3.5 4.5 3 7.33333 3 10C3 12.6667 3.5 15.5 4 15.8333C4.5 16.1667 8 16.5 12 16.5Z"
            stroke="#fff"
            stroke-width="1"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      }
      <label>{{ video.device?.label || 'Unnamed Device' }}</label>
    </div>
  }

  @for (audio of recordingService.audioSources(); track $index) {
    <div class="audio-item">
      <svg
        style="flex-shrink: 0;"
        width="16px"
        height="16px"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M19 10V12C19 15.866 15.866 19 12 19M5 10V12C5 15.866 8.13401 19 12 19M12 19V22M8 22H16M12 15C10.3431 15 9 13.6569 9 12V5C9 3.34315 10.3431 2 12 2C13.6569 2 15 3.34315 15 5V12C15 13.6569 13.6569 15 12 15Z"
          stroke="#fff"
          stroke-width="1"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      <label>{{ audio.device.label || 'Unnamed Device' }}</label>
      <app-audio-visualizer [stream]="audio.stream"></app-audio-visualizer>
    </div>
  }
</div>
